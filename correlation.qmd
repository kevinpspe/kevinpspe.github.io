# Issue of Selection Bias

<br />

Let us look at this causal question:

::: center-graph
```{dot}
//| fig-width: 4
//| fig-height: 0.45
digraph example1 {
  // Nodes
  D [shape=box, label="Going to the Hospital (D)"]
  Y [shape=box, label="Health Outcomes (Y)"]

  // Edges
  D -> Y [label="Causal Effect"]

  // Graph styling
  rankdir=LR; // Left to right layout
}
```
:::

If we just collect correlation data, we likely find the following:

-   The average health of individuals who got hospital treatment is [low]{.underline}.
-   The average health of individuals who did not get hospital treatment is [high]{.underline}.
-   Thus, we find that hospital treatment is correlated with **worse** health outcomes.

But does that mean hospital treatment **causes** worse health outcomes? **No!** The reason we have a negative correlation is because the people who get treated, and the people who do not get treated, are different **before** the treatment.

-   Less healthy people are more likely to go to the hospital to get treated in the first place. That means before the hospital even begins treatment, there are **pre-existing differences** between people getting treatment and people that are untreated.

Thus, we cannot tell if the difference in health outcomes between treated and untreated is due to the treatment, or due to **their pre-existing differences**.

<br />

We can illustrate the same point using potential outcomes from last chapter:

|                       | Treated                                                                                                | Untreated                                                                                                  |
|:-----------------|:--------------------------|:--------------------------|
| Observed $\mean Y$    | $\mean Y_\text{treated} = \textcolor{purple}{\mean Y_{\text{treated}}^{(1)}}$                          | $\mean Y_\text{untreated} = \textcolor{purple}{\mean Y_{\text{untreated}}^{(0)}}$                          |
| Counterfactual        | $\textcolor{red}{\mean Y_{\text{treated}}^{(0)}}$                                                      | $\textcolor{red}{\mean Y_{\text{untreated}}^{(1)}}$                                                        |
| Real Treatment Effect | $\textcolor{purple}{\mean Y_{\text{treated}}^{(1)}} - \textcolor{red}{\mean Y_{\text{treated}}^{(0)}}$ | $\textcolor{red}{\mean Y_{\text{untreated}}^{(1)}} - \textcolor{purple}{\mean Y_{\text{untreated}}^{(0)}}$ |

: This table uses what we learned about counterfactuals (@tbl-observed) and treatment effects. {#tbl-selbias tbl-colwidths="\[24,38,38\]" .bordered}

We see the real treatment effects. But how do these treatment effects compare to correlation:

$$
\begin{align}
\text{correlation} & = \mean Y_\text{treated} - \mean Y_\text{untreated} \\
& = \textcolor{purple}{\mean Y_{\text{treated}}^{(1)}} - \textcolor{purple}{\mean Y_\text{untreated}^{(0)}}
\end{align}
$$

::: aside
Correlation is the difference in observed outcomes.
:::

If we compare this correlation equation to our treatment effects, in our table, we see:

$$
\text{if  } \textcolor{purple}{\mean Y_\text{untreated}^{(0)}} ≠ \textcolor{red}{\mean Y_\text{treated}^{(0)}}, \text{ then correlation} ≠ \text{causation}
$$

-   What are these two values? They are the average potential outcomes of each group (treatment and control), [in the parallel world of not recieving the treatment]{.underline}.
-   Or we can think of it as the average outcomes **before** treatment.

Thus, if there is a difference between the average outcomes between treated and untreated **before** treatment is administered, then correlation is not equal to causation.

<br />

A **confounder** is a third variable that has the following characteristics:

1.  The confounder is correlated (positive or negative) with the outcome variable.
2.  The confounder causes who gets and doesn't get the treatment.
3.  The confounder is **not** itself caused by the treatment.

A confounder will cause some people to get the treatment, and others to not get the treatment. A confounder is also correlated with the outcome.

These two facts mean that before we even start the treatment, people who [will get]{.underline} the treatment **differ** from people who [will not get]{.underline} the treatment.

Thus, [**confounders cause selection bias and pre-existing differences.**]{.underline}

<br />

For example, in our hospital-health example, a confounder could be **smoking**.

-   Smoking will worsen health outcomes. Someone who smokes is also more likely to visit the hospital with health complications.
-   That means people who go to the hospital start out with (on average) worse health outcomes than people who did not go to the hospital.

::: aside
Note: smoking is not the only possible confounder, we just use it as an example. Drinking, age, etc. are all other potential confounders.
:::

::: center-graph
```{dot}
//| fig-width: 4
//| fig-height: 1.1
digraph example2 {
  // Nodes
  D [shape=box, pos = "0,0!", label="Going to the Hospital (D)"]
  X [shape=box, pos = "2,0!", label="Smoking (Confounder)"]
  Y [shape=box, pos = "1,-1!", label="Health Outcomes (Y)"]

  // Edges
  {rank=same; D -> Y [label="Causal Effect"]}
  X -> D
  X -> Y [dir=both]
  
  graph [nodesep=0.5, ranksep=0.5]

}
```
:::

This means that the treated group has more smokers and people with bad health than the untreated group. This pre-existing difference between treated and untreated means correlation is not equal to causation.
